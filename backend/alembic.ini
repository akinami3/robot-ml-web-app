# =============================================================================
# Alembic 設定ファイル（alembic.ini）
# =============================================================================
#
# 【このファイルの役割】
# Alembic（アレンビック）のメイン設定ファイルです。
# データベースのマイグレーション（スキーマ変更管理）に使用されます。
#
# 【Alembic とは？】
# SQLAlchemy 用のデータベースマイグレーションツールです。
# データベースのテーブル構造（スキーマ）を「バージョン管理」できます。
#
# 例えば：
#   - テーブルに新しいカラムを追加したい
#   - テーブル名を変更したい
#   - インデックスを追加したい
# このような変更を「マイグレーションスクリプト」として記録し、
# チーム全員のデータベースに同じ変更を適用できます。
#
# 【マイグレーションの流れ】
#   1. alembic revision --autogenerate -m "add user table"
#      → SQLAlchemy モデルの変更を検出し、マイグレーションスクリプトを自動生成
#   2. alembic upgrade head
#      → 最新のマイグレーションまでデータベースを更新
#   3. alembic downgrade -1
#      → 1 つ前の状態に戻す（ロールバック）
#
# 【INI ファイル形式とは？】
# [セクション名] で区分されたキー = 値 形式の設定ファイルです。
# Python の標準ライブラリ configparser で読み込まれます。
# Windows の .ini ファイルと同じ形式です。
# =============================================================================

# Alembic configuration

# =============================================================================
# [alembic] セクション - Alembic の基本設定
# =============================================================================
[alembic]

# ---------------------------------------------------------------------------
# script_location
# ---------------------------------------------------------------------------
# マイグレーションスクリプトが格納されるディレクトリのパス。
# ここでは「alembic」ディレクトリを指定しています。
# このディレクトリ内に以下のファイルが含まれます：
#   - env.py:      マイグレーション実行時の環境設定
#   - versions/:   各マイグレーションスクリプトが保存されるフォルダ
#   - script.py.mako: 新規マイグレーションのテンプレート
# ---------------------------------------------------------------------------
script_location = alembic

# ---------------------------------------------------------------------------
# prepend_sys_path
# ---------------------------------------------------------------------------
# Python のモジュール検索パス（sys.path）の先頭に追加するパス。
# "." はカレントディレクトリを意味します。
# これにより、プロジェクトの app パッケージを import できるようになります。
# ---------------------------------------------------------------------------
prepend_sys_path = .

# ---------------------------------------------------------------------------
# sqlalchemy.url
# ---------------------------------------------------------------------------
# データベース接続 URL（SQLAlchemy 形式）。
#
# 【URL の構造】
#   driver://user:pass@localhost/dbname
#   ^^^^^^  ^^^^ ^^^^ ^^^^^^^^^ ^^^^^^
#   |       |    |    |         |
#   |       |    |    ホスト名   データベース名
#   |       ユーザー名 パスワード
#   ドライバー名（DB の種類）
#
# 【実際の使用例】
#   PostgreSQL: postgresql+asyncpg://myuser:mypass@localhost:5432/robotai
#   SQLite:     sqlite:///./data/app.db
#   MySQL:      mysql+pymysql://user:pass@localhost/mydb
#
# ⚠️ セキュリティ注意 ⚠️
# この値はプレースホルダー（仮の値）です！
# 本番環境では、環境変数 DATABASE_URL から読み込むように
# env.py で上書きする設定になっています。
# パスワードを .ini ファイルに直接書くのは危険です。
# ---------------------------------------------------------------------------
sqlalchemy.url = driver://user:pass@localhost/dbname

# ---------------------------------------------------------------------------
# [post_write_hooks]
# ---------------------------------------------------------------------------
# マイグレーションスクリプト生成後に自動実行するフック（処理）。
# 例：コードフォーマッター（black, ruff）を自動実行する設定ができます。
# 現在は空（フックなし）。
#
# 設定例（ruff でフォーマットする場合）：
#   hooks = ruff
#   ruff.type = console_scripts
#   ruff.entrypoint = ruff
#   ruff.options = format REVISION_SCRIPT_FILENAME
# ---------------------------------------------------------------------------
[post_write_hooks]

# =============================================================================
# ログ設定セクション
# =============================================================================
# Python の標準 logging モジュールの設定です。
# Alembic 実行時のログ出力を制御します。
#
# 【ログとは？】
# プログラムの動作状況を記録する仕組みです。
# デバッグ（問題の原因調査）やモニタリング（運用監視）に重要です。
#
# 【ログレベル（重要度の低い順）】
#   DEBUG   → 詳細なデバッグ情報
#   INFO    → 一般的な動作情報（マイグレーション実行など）
#   WARN    → 警告（問題の可能性があるが動作は継続）
#   ERROR   → エラー（処理が失敗した）
#   CRITICAL → 致命的エラー（システムが停止する可能性）
# =============================================================================

# ---------------------------------------------------------------------------
# [loggers] - ロガー（ログ出力者）の一覧
# ---------------------------------------------------------------------------
# root:      アプリケーション全体のデフォルトロガー
# sqlalchemy: SQLAlchemy（データベース操作）のロガー
# alembic:   Alembic（マイグレーション）のロガー
# ---------------------------------------------------------------------------
[loggers]
keys = root,sqlalchemy,alembic

# ---------------------------------------------------------------------------
# [handlers] - ハンドラー（ログの出力先）の一覧
# ---------------------------------------------------------------------------
# console: ターミナル（標準エラー出力）にログを表示するハンドラー
# 他にもファイルハンドラー（ログファイルに出力）などが設定可能。
# ---------------------------------------------------------------------------
[handlers]
keys = console

# ---------------------------------------------------------------------------
# [formatters] - フォーマッター（ログの表示形式）の一覧
# ---------------------------------------------------------------------------
# generic: 汎用的なログフォーマット
# ---------------------------------------------------------------------------
[formatters]
keys = generic

# ---------------------------------------------------------------------------
# [logger_root] - ルートロガーの設定
# ---------------------------------------------------------------------------
# すべてのロガーの親。ここで捕捉されなかったログはここで処理されます。
# level = WARN → 警告以上のログのみ出力（DEBUG, INFO は省略）
# handlers = console → ターミナルに出力
# ---------------------------------------------------------------------------
[logger_root]
level = WARN
handlers = console
qualname =

# ---------------------------------------------------------------------------
# [logger_sqlalchemy] - SQLAlchemy ロガーの設定
# ---------------------------------------------------------------------------
# SQLAlchemy が発行する SQL 文のログを制御します。
# level = WARN → 警告以上のみ出力
# level = INFO にすると、実行される SQL 文がすべて表示されます（デバッグに便利）
# qualname = sqlalchemy.engine → SQLAlchemy のエンジン部分のログを対象
# ---------------------------------------------------------------------------
[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

# ---------------------------------------------------------------------------
# [logger_alembic] - Alembic ロガーの設定
# ---------------------------------------------------------------------------
# Alembic の動作ログを制御します。
# level = INFO → マイグレーション実行情報が表示される
# 例：「Running upgrade abc123 -> def456, add user table」
# ---------------------------------------------------------------------------
[logger_alembic]
level = INFO
handlers =
qualname = alembic

# ---------------------------------------------------------------------------
# [handler_console] - コンソールハンドラーの設定
# ---------------------------------------------------------------------------
# class = StreamHandler → 出力ストリーム（画面やファイル）にログを書き出す
# args = (sys.stderr,) → 標準エラー出力（stderr）に出力
#   ※ stderr を使う理由：通常の出力（stdout）とログを分離するため
#     パイプやリダイレクトで通常出力だけを取り出せる
# level = NOTSET → このハンドラーではフィルタしない（ロガー側で制御）
# formatter = generic → 下記の generic フォーマッターを使用
# ---------------------------------------------------------------------------
[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

# ---------------------------------------------------------------------------
# [formatter_generic] - 汎用フォーマッターの設定
# ---------------------------------------------------------------------------
# format: ログメッセージの表示形式
#   %(levelname)-5.5s → ログレベル名を 5 文字で左揃え表示
#     例：INFO, WARN, ERROR
#   [%(name)s] → ロガー名を角括弧で囲んで表示
#     例：[alembic.runtime.migration]
#   %(message)s → ログメッセージ本文
#
# datefmt: 日時のフォーマット
#   %H:%M:%S → 時:分:秒（例：14:30:00）
#
# 出力例：INFO  [alembic.runtime.migration] Running upgrade abc -> def
# ---------------------------------------------------------------------------
[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
