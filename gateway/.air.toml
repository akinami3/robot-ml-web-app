# =============================================================================
# ファイル: .air.toml
# 概要: air（ホットリロードツール）の設定ファイル
# =============================================================================
#
# 【TOML形式とは？】
# Tom's Obvious, Minimal Language の略。
# 設定ファイルのためのシンプルなファイル形式。
# INI ファイルに似ているが、より厳密な構文を持つ。
#
# 基本的な書き方:
#   キー = "値"           （文字列 → ダブルクォーテーションで囲む）
#   キー = 123             （数値 → そのまま書く）
#   キー = true            （真偽値 → true または false）
#   キー = ["a", "b"]      （配列 → 角括弧で囲む）
#   [セクション名]          （セクション → 角括弧で囲む）
#
# 【air（エアー）とは？】
# Go 用のライブリロード（ホットリロード）ツール。
# ソースコードの変更を自動検出し、ビルド→再起動を自動で行う。
# 開発中にいちいち手動で「go build」→「./main」をやらなくてよくなる！
#
# 【ホットリロードの動作フロー】
# 1. air が起動し、このファイルの設定を読み込む
# 2. 指定されたディレクトリとファイル拡張子を監視開始
# 3. ファイルの変更を検出！
# 4. [build] セクションの cmd で指定されたビルドコマンドを実行
# 5. ビルド成功 → 新しいバイナリを起動
# 6. ビルド失敗 → エラーログに記録、前のバイナリは停止したまま
# 7. 次の変更を待つ（2に戻る）
# =============================================================================

# プロジェクトのルートディレクトリ
# "." はカレントディレクトリ（現在のディレクトリ）を意味する
root = "."

# テストデータ用のディレクトリ
# テスト時に使うデータファイルを格納するディレクトリのパス
testdata_dir = "testdata"

# 一時ファイルを格納するディレクトリ
# ビルドされたバイナリはここに保存される
# この "tmp" ディレクトリは .gitignore に追加しておくとよい
tmp_dir = "tmp"

# =============================================================================
# [build] セクション: ビルドに関する設定
# =============================================================================
#
# 【ビルドとは？】
# Go のソースコード（.go ファイル）をコンピュータが実行できるバイナリ
# （実行可能ファイル）に変換する処理。
# Go はコンパイル言語なので、実行前にビルドが必要。
# （Python や JavaScript のようなインタプリタ言語とは異なる）
# =============================================================================
[build]
  # ---------------------------------------------------------------------------
  # args_bin: バイナリ実行時に渡す引数
  # ---------------------------------------------------------------------------
  # 空配列 = 引数なし
  # 例: ["--port", "8080"] のように起動引数を指定できる
  args_bin = []

  # ---------------------------------------------------------------------------
  # bin: ビルドされたバイナリ（実行ファイル）の出力先パス
  # ---------------------------------------------------------------------------
  # ビルドコマンドで生成されるバイナリファイルの場所。
  # air はビルド後に、このファイルを実行してサーバーを起動する。
  bin = "./tmp/gateway"

  # ---------------------------------------------------------------------------
  # cmd: ビルドコマンド
  # ---------------------------------------------------------------------------
  # ファイル変更が検出されたときに実行されるコマンド。
  # go build: Go のソースコードをコンパイルするコマンド
  #   -o ./tmp/gateway: 出力ファイル名を指定（tmp/gateway に保存）
  #   ./cmd/gateway/: コンパイル対象のパッケージ（main パッケージがあるディレクトリ）
  #
  # 【なぜ本番用 Dockerfile のビルドコマンドと違うのか？】
  # 本番用: CGO_ENABLED=0 -ldflags="-w -s" → 最小化・最適化重視
  # 開発用: オプションなし → ビルド速度とデバッグしやすさ重視
  # 開発中はデバッグ情報が残っている方がエラーの調査がしやすい
  cmd = "go build -o ./tmp/gateway ./cmd/gateway/"

  # ---------------------------------------------------------------------------
  # delay: ファイル変更を検出してからビルドを開始するまでの待ち時間（ミリ秒）
  # ---------------------------------------------------------------------------
  # 1000ミリ秒 = 1秒 待ってからビルドを開始する。
  # 【なぜ遅延を設けるのか？】
  # ファイルを保存するたびに即座にビルドすると、複数ファイルを連続保存した時に
  # 何度もビルドが走ってしまう。少し待つことで、まとめて1回のビルドにできる。
  # エディタの自動保存機能と組み合わせる場合に特に効果的。
  delay = 1000

  # ---------------------------------------------------------------------------
  # exclude_dir: 監視対象から除外するディレクトリ
  # ---------------------------------------------------------------------------
  # これらのディレクトリ内のファイルが変更されても、リビルドは行われない。
  # "assets":   静的ファイル（Go のソースではないため除外）
  # "tmp":      ビルド出力先（ここの変更で再ビルドしたら無限ループになる！）
  # "vendor":   外部ライブラリのコピー（通常変更しない）
  # "testdata": テスト用データ（コード変更ではないため除外）
  exclude_dir = ["assets", "tmp", "vendor", "testdata"]

  # ---------------------------------------------------------------------------
  # exclude_file: 監視対象から除外するファイル
  # ---------------------------------------------------------------------------
  # 特定のファイルを除外したい場合にファイル名を指定する。
  # 空配列 = 除外ファイルなし
  exclude_file = []

  # ---------------------------------------------------------------------------
  # exclude_regex: 正規表現で監視対象から除外するファイルパターン
  # ---------------------------------------------------------------------------
  # "_test.go": テストファイルを除外する
  # テストファイルの変更でサーバーを再起動する必要はないため除外する。
  # テストは別途「go test」コマンドで実行する。
  #
  # 【正規表現（Regex）とは？】
  # テキストのパターンを表現するための記法。
  # "_test.go" は「_test.go を含むファイル名」にマッチする。
  exclude_regex = ["_test.go"]

  # ---------------------------------------------------------------------------
  # exclude_unchanged: 変更されていないファイルを除外するか
  # ---------------------------------------------------------------------------
  # false = 変更がなくても監視対象に含める
  exclude_unchanged = false

  # ---------------------------------------------------------------------------
  # follow_symlink: シンボリックリンクを追跡するか
  # ---------------------------------------------------------------------------
  # false = シンボリックリンク先のファイル変更は無視する
  # 【シンボリックリンクとは？】
  # ファイルやディレクトリへのショートカット（参照）のこと。
  # Windows のショートカットに似た概念。
  follow_symlink = false

  # ---------------------------------------------------------------------------
  # full_bin: ビルド後に実行する完全なコマンド（オプション）
  # ---------------------------------------------------------------------------
  # 空文字列 = 使用しない（bin の値がそのまま使われる）
  # 環境変数を設定して起動したい場合などに使う。
  # 例: "ENV=dev ./tmp/gateway -port 8080"
  full_bin = ""

  # ---------------------------------------------------------------------------
  # include_dir: 追加で監視するディレクトリ
  # ---------------------------------------------------------------------------
  # 空配列 = ルートディレクトリ以下すべて（exclude を除く）を監視
  include_dir = []

  # ---------------------------------------------------------------------------
  # include_ext: 監視対象のファイル拡張子
  # ---------------------------------------------------------------------------
  # これらの拡張子を持つファイルが変更されたときにリビルドが実行される。
  # "go":   Go のソースコード（メインの監視対象）
  # "tpl":  テンプレートファイル（Go のtext/templateなどで使用）
  # "tmpl": テンプレートファイル（同上）
  # "html": HTMLファイル（テンプレートとして埋め込まれる場合）
  #
  # 【含まれていない拡張子のファイル（例: .json, .md）が変更されても、
  #   リビルドは行われない】
  include_ext = ["go", "tpl", "tmpl", "html"]

  # ---------------------------------------------------------------------------
  # include_file: 追加で監視する特定のファイル
  # ---------------------------------------------------------------------------
  # 特定のファイル名を指定して監視対象に含める。
  # 空配列 = 追加ファイルなし
  include_file = []

  # ---------------------------------------------------------------------------
  # kill_delay: 古いプロセスを停止してから新プロセスを起動するまでの待ち時間
  # ---------------------------------------------------------------------------
  # "0s" = 待ち時間なし（即座に切り替える）
  # サーバーがグレースフルシャットダウンに時間がかかる場合は増やす。
  # 【グレースフルシャットダウンとは？】
  # 処理中のリクエストを完了してから停止する、丁寧な停止方法。
  kill_delay = "0s"

  # ---------------------------------------------------------------------------
  # log: ビルドエラーのログファイル
  # ---------------------------------------------------------------------------
  # ビルドが失敗した場合のエラーメッセージがこのファイルに記録される。
  # 後からエラーの内容を確認する際に便利。
  log = "build-errors.log"

  # ---------------------------------------------------------------------------
  # poll: ポーリングモードを使うか
  # ---------------------------------------------------------------------------
  # false = OS のファイルシステムイベント通知を使う（推奨、効率的）
  # true = 定期的にファイルの変更をチェックする（Docker環境で問題がある場合に使う）
  # 【ポーリングとは？】
  # 定期的に「変更ありましたか？」と確認すること。
  # イベント通知の方が効率的だが、Docker のボリュームマウント環境では
  # イベントが正常に伝わらないことがあり、その場合はポーリングを使う。
  poll = false

  # ---------------------------------------------------------------------------
  # poll_interval: ポーリング間隔（ミリ秒）
  # ---------------------------------------------------------------------------
  # poll = true の場合に使われる。0 = デフォルト値を使用。
  poll_interval = 0

  # ---------------------------------------------------------------------------
  # rerun: ファイル変更なしでも定期的に再実行するか
  # ---------------------------------------------------------------------------
  # false = ファイル変更時のみ再ビルドする
  rerun = false

  # ---------------------------------------------------------------------------
  # rerun_delay: rerun = true の場合の再実行間隔（ミリ秒）
  # ---------------------------------------------------------------------------
  # 500ミリ秒 = 0.5秒間隔で再実行（rerun = true の場合のみ有効）
  rerun_delay = 500

  # ---------------------------------------------------------------------------
  # send_interrupt: プロセス停止時に SIGINT シグナルを送信するか
  # ---------------------------------------------------------------------------
  # false = SIGTERM（通常の終了信号）を送信する
  # true = SIGINT（Ctrl+C と同じ割り込み信号）を送信する
  #
  # 【シグナルとは？】
  # Linux/Unix でプロセスに送る通知メッセージのこと。
  # SIGTERM: 「終了してください」という丁寧な終了要求
  # SIGINT:  「中断してください」という割り込み要求（Ctrl+C）
  # SIGKILL: 「強制終了」（プログラム側で無視できない）
  send_interrupt = false

  # ---------------------------------------------------------------------------
  # stop_on_error: ビルドエラー時にプログラムを停止するか
  # ---------------------------------------------------------------------------
  # true = ビルドエラーが発生したら、以前のバイナリも停止する
  # false = ビルドエラーでも、以前のバイナリは動き続ける
  stop_on_error = true

# =============================================================================
# [color] セクション: ターミナル出力の色設定
# =============================================================================
#
# air のターミナル出力に色を付けて、見やすくする設定。
# 空文字列 = デフォルトの色を使用
# 利用可能な色: "red", "green", "yellow", "blue", "magenta", "cyan", "white"
# =============================================================================
[color]
  # アプリケーション（実際のプログラム）の出力色
  app = ""
  # ビルド関連メッセージの色（黄色 → 注目しやすい）
  build = "yellow"
  # メインプロセスのメッセージ色（マゼンタ → 目立つ色）
  main = "magenta"
  # ランナー（実行管理）のメッセージ色（緑 → 正常動作を示す）
  runner = "green"
  # ファイル監視のメッセージ色（シアン → 情報系の色）
  watcher = "cyan"

# =============================================================================
# [log] セクション: ログの設定
# =============================================================================
[log]
  # メインプロセスのログのみを表示するか
  # false = air のすべてのログ（ビルド、監視など）を表示
  # true = メインアプリケーションのログのみ表示
  main_only = false

  # ログメッセージにタイムスタンプ（時刻）を付けるか
  # false = 時刻を表示しない（開発中は不要なことが多い）
  # true にすると各ログ行の先頭に時刻が表示される
  time = false

# =============================================================================
# [misc] セクション: その他の設定
# =============================================================================
[misc]
  # air 終了時に一時ファイル（tmp ディレクトリ）を削除するか
  # false = 削除しない（次回起動時のビルドが内容によっては速くなる場合がある）
  # true = 削除する（ディスクスペースを節約）
  clean_on_exit = false

# =============================================================================
# [screen] セクション: 画面表示の設定
# =============================================================================
[screen]
  # リビルド時にターミナル画面をクリアするか
  # false = クリアしない（過去のログも残る）
  # true = リビルドのたびに画面をクリアして見やすくする
  clear_on_rebuild = false

  # スクロール位置を保持するか
  # true = スクロール位置を維持する（ログを遡って見やすい）
  # false = 新しいログが表示されるたびに最下部にスクロール
  keep_scroll = true
