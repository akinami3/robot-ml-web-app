/**
 * useKeyboardControl.ts - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ãƒ­ãƒœãƒƒãƒˆã‚’æ“ä½œã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
 *
 * =====================================================================
 * ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¦‚è¦ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½•ã‚’ã™ã‚‹ã‹ï¼‰
 * =====================================================================
 * ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Œã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã€ï¼ˆCustom Hookï¼‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
 * ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã¯ã€Reactã®æ©Ÿèƒ½ï¼ˆuseEffect, useCallbackãªã©ï¼‰ã‚’
 * çµ„ã¿åˆã‚ã›ã¦ã€å†åˆ©ç”¨å¯èƒ½ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚
 *
 * ã“ã®ãƒ•ãƒƒã‚¯ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã«
 * ãƒ­ãƒœãƒƒãƒˆã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼š
 *   - W / â†‘ : å‰é€²ï¼ˆForwardï¼‰
 *   - S / â†“ : å¾Œé€€ï¼ˆBackwardï¼‰
 *   - A / â† : å·¦æ—‹å›ï¼ˆLeftï¼‰
 *   - D / â†’ : å³æ—‹å›ï¼ˆRightï¼‰
 *   - ã‚¹ãƒšãƒ¼ã‚¹ : åœæ­¢ï¼ˆStopï¼‰
 *   - Escape : ç·Šæ€¥åœæ­¢ï¼ˆEmergency Stopï¼‰
 *
 * ğŸ’¡ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šCustom Hook ãƒ‘ã‚¿ãƒ¼ãƒ³
 * - Reactã§ã¯ã€Œuseã€ã§å§‹ã¾ã‚‹é–¢æ•°ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨å‘¼ã³ã¾ã™
 * - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã—ã¦å†åˆ©ç”¨å¯èƒ½ã«ã—ã¾ã™
 * - è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§åŒã˜ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚’ä½¿ã„å›ã›ã¾ã™
 * =====================================================================
 */

// === ã‚¤ãƒ³ãƒãƒ¼ãƒˆéƒ¨åˆ† ===
// useEffect: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã€Œå‰¯ä½œç”¨ã€ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²ãªã©ï¼‰ã‚’ç®¡ç†ã™ã‚‹Reactãƒ•ãƒƒã‚¯
//   - å‰¯ä½œç”¨ã¨ã¯ã€ç”»é¢ã®æç”»ä»¥å¤–ã®å‡¦ç†ï¼ˆAPIã‚³ãƒ¼ãƒ«ã€ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã€ã‚¿ã‚¤ãƒãƒ¼ãªã©ï¼‰ã®ã“ã¨
//   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆï¼ˆç”»é¢ã«è¡¨ç¤ºï¼‰ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã€
//     ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆï¼ˆç”»é¢ã‹ã‚‰æ¶ˆãˆã‚‹ï¼‰ã¨ãã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’å®Ÿè¡Œã§ãã¾ã™
//
// useCallback: é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ã™ã‚‹Reactãƒ•ãƒƒã‚¯
//   - ãƒ¡ãƒ¢åŒ–ã¨ã¯ã€åŒã˜é–¢æ•°ã‚’ä½•åº¦ã‚‚ä½œã‚Šç›´ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨
//   - ä¾å­˜é…åˆ—ã®å€¤ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šã€åŒã˜é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã„å›ã—ã¾ã™
//   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã«é‡è¦ã§ã™ï¼ˆä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ãï¼‰
import { useEffect, useCallback } from "react";

// =====================================================================
// ğŸ“ TypeScriptã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
// =====================================================================
// interfaceï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã€Œå‹ã€ï¼ˆå½¢ï¼‰ã‚’å®šç¾©ã™ã‚‹TypeScriptã®æ©Ÿèƒ½
// - ã€Œã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€ã“ã†ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¿…è¦ã§ã™ã€ã¨ã„ã†è¨­è¨ˆå›³
// - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å‹ãƒã‚§ãƒƒã‚¯ãŒè¡Œã‚ã‚Œã€é–“é•ã„ã‚’æ—©æœŸç™ºè¦‹ã§ãã¾ã™
//
// KeyboardConfig: ã“ã®ãƒ•ãƒƒã‚¯ã«æ¸¡ã™è¨­å®šã®å‹å®šç¾©
// - å„ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã™ã‚‹ã€Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã€ã‚’æŒ‡å®šã—ã¾ã™
// - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°: ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã¨ãã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°
// - () => void: å¼•æ•°ãªã—ã€æˆ»ã‚Šå€¤ãªã—ã®é–¢æ•°ã®å‹
//   - () ã¯å¼•æ•°ãŒãªã„ã“ã¨ã‚’ç¤ºã™
//   - void ã¯ä½•ã‚‚è¿”ã•ãªã„ã“ã¨ã‚’ç¤ºã™
interface KeyboardConfig {
  onForward: () => void;    // å‰é€²ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
  onBackward: () => void;   // å¾Œé€€ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
  onLeft: () => void;       // å·¦æ—‹å›ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
  onRight: () => void;      // å³æ—‹å›ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
  onStop: () => void;       // åœæ­¢ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
  onEStop: () => void;      // ç·Šæ€¥åœæ­¢ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
  enabled: boolean;         // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãŒæœ‰åŠ¹ã‹ã©ã†ã‹ï¼ˆtrue=æœ‰åŠ¹ã€false=ç„¡åŠ¹ï¼‰
}

// =====================================================================
// ğŸ® useKeyboardControl ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯æœ¬ä½“
// =====================================================================
// export: ã“ã®é–¢æ•°ã‚’ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
// function: é–¢æ•°ã®å®šç¾©ï¼ˆReactãƒ•ãƒƒã‚¯ã¯é€šå¸¸ã®é–¢æ•°ã¨ã—ã¦æ›¸ãã¾ã™ï¼‰
//
// å¼•æ•°ã® { ... }: ã€Œåˆ†å‰²ä»£å…¥ã€ï¼ˆDestructuringï¼‰
// - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã ã‘ã‚’å–ã‚Šå‡ºã™ä¾¿åˆ©ãªæ›¸ãæ–¹
// - KeyboardConfigå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å€‹åˆ¥ã®å¤‰æ•°ã«å±•é–‹
// - ä¾‹: { onForward, onBackward, ... } = config ã¨åŒã˜æ„å‘³
export function useKeyboardControl({
  onForward,
  onBackward,
  onLeft,
  onRight,
  onStop,
  onEStop,
  enabled,
}: KeyboardConfig) {
  // ===================================================================
  // ğŸ”½ handleKeyDown - ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
  // ===================================================================
  // useCallback ã§ãƒ¡ãƒ¢åŒ–ã™ã‚‹ç†ç”±ï¼š
  // - ã“ã®é–¢æ•°ã¯ useEffect å†…ã§ addEventListener ã«æ¸¡ã•ã‚Œã¾ã™
  // - useCallback ã‚’ä½¿ã‚ãªã„ã¨ã€æ¯å›æ–°ã—ã„é–¢æ•°ãŒä½œã‚‰ã‚Œã€
  //   useEffect ãŒä¸è¦ã«å†å®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã„ã¾ã™
  //
  // ç¬¬1å¼•æ•°: ãƒ¡ãƒ¢åŒ–ã—ãŸã„é–¢æ•°
  // ç¬¬2å¼•æ•°: ä¾å­˜é…åˆ—ï¼ˆã“ã®é…åˆ—ã®å€¤ãŒå¤‰ã‚ã‚‹ã¨é–¢æ•°ãŒå†ä½œæˆã•ã‚Œã‚‹ï¼‰
  //
  // (e: KeyboardEvent) => { ... }
  // - ã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼ˆçŸ¢å°é–¢æ•°ï¼‰: function ã®çœç•¥è¨˜æ³•
  // - e ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆKeyboardEventå‹ï¼‰
  // - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã«ã¯ã€æŠ¼ã•ã‚ŒãŸã‚­ãƒ¼ã®æƒ…å ±ï¼ˆe.keyï¼‰ãªã©ãŒå«ã¾ã‚Œã¾ã™
  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      // enabled ãŒ false ãªã‚‰ã€ä½•ã‚‚ã›ãšã«é–¢æ•°ã‚’çµ‚äº†ã™ã‚‹
      // returnæ–‡ã§é–¢æ•°ã‚’æ—©æœŸçµ‚äº†ã™ã‚‹ã€Œã‚¬ãƒ¼ãƒ‰ç¯€ã€ï¼ˆEarly Returnï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³
      if (!enabled) return;

      // â”€â”€â”€ å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã®ã‚­ãƒ¼å…¥åŠ›ã‚’ç„¡è¦–ã™ã‚‹ â”€â”€â”€
      // instanceofæ¼”ç®—å­: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç‰¹å®šã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã©ã†ã‹ã‚’èª¿ã¹ã‚‹
      // - e.target: ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸè¦ç´ ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒã‚ã‚‹è¦ç´ ï¼‰
      // - HTMLInputElement: <input> ã‚¿ã‚°ã®è¦ç´ ã‚¯ãƒ©ã‚¹
      // - HTMLTextAreaElement: <textarea> ã‚¿ã‚°ã®è¦ç´ ã‚¯ãƒ©ã‚¹
      //
      // ãªãœå¿…è¦ï¼Ÿ
      // ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ¬„ã«ã€Œwã€ã¨æ‰“ã¤ã¨ã€ãƒ­ãƒœãƒƒãƒˆãŒå‰é€²ã—ã¦ã—ã¾ã†ã®ã‚’é˜²ããŸã‚ï¼
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¤œç´¢ãƒãƒ¼ã‚„ãƒãƒ£ãƒƒãƒˆã«æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ã„ã‚‹ã¨ãã¯ã€
      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ç„¡åŠ¹ã«ã—ã¾ã™
      if (
        e.target instanceof HTMLInputElement ||
        e.target instanceof HTMLTextAreaElement
      )
        return;

      // â”€â”€â”€ switchæ–‡: ã‚­ãƒ¼ã«å¿œã˜ãŸå‡¦ç†ã®åˆ†å² â”€â”€â”€
      // switch/caseæ–‡: 1ã¤ã®å€¤ï¼ˆe.keyï¼‰ã«å¯¾ã—ã¦è¤‡æ•°ã®æ¡ä»¶åˆ†å²ã‚’æ›¸ãæ–¹æ³•
      // if/else if ã‚’ä½•å€‹ã‚‚æ›¸ãã‚ˆã‚Šã€è¦‹ã‚„ã™ããªã‚Šã¾ã™
      //
      // e.key: æŠ¼ã•ã‚ŒãŸã‚­ãƒ¼ã®æ–‡å­—åˆ—è¡¨ç¾
      // - "w" â†’ Wã‚­ãƒ¼ã€"ArrowUp" â†’ ä¸ŠçŸ¢å°ã‚­ãƒ¼
      // - "a" â†’ Aã‚­ãƒ¼ã€"ArrowLeft" â†’ å·¦çŸ¢å°ã‚­ãƒ¼
      // - " "ï¼ˆåŠè§’ã‚¹ãƒšãƒ¼ã‚¹ï¼‰â†’ ã‚¹ãƒšãƒ¼ã‚¹ãƒãƒ¼
      // - "Escape" â†’ Escapeã‚­ãƒ¼
      //
      // case ã®å¾Œã« break ãŒãªã„ã¨ã€æ¬¡ã® case ã‚‚å®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã†
      // ï¼ˆã€Œãƒ•ã‚©ãƒ¼ãƒ«ã‚¹ãƒ«ãƒ¼ã€ã¨å‘¼ã°ã‚Œã‚‹ï¼‰ã®ã§æ³¨æ„ï¼
      switch (e.key) {
        // â”€â”€ å‰é€²: W ã‚­ãƒ¼ã¾ãŸã¯ä¸ŠçŸ¢å°ã‚­ãƒ¼ â”€â”€
        case "w":
        case "ArrowUp":
          // e.preventDefault(): ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
          // - ä¾‹: çŸ¢å°ã‚­ãƒ¼ã§ãƒšãƒ¼ã‚¸ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã®ã‚’é˜²ã
          // - ä¾‹: ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ãƒšãƒ¼ã‚¸ãŒä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã®ã‚’é˜²ã
          // - ãƒ­ãƒœãƒƒãƒˆæ“ä½œã«å°‚å¿µã•ã›ã‚‹ãŸã‚ã«é‡è¦ãªå‡¦ç†ã§ã™
          e.preventDefault();
          // onForward ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã€å‰é€²å‡¦ç†ã‚’å®Ÿè¡Œ
          onForward();
          break; // switchæ–‡ã‹ã‚‰æŠœã‘ã‚‹ï¼ˆã“ã‚ŒãŒãªã„ã¨æ¬¡ã®caseã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰

        // â”€â”€ å¾Œé€€: S ã‚­ãƒ¼ã¾ãŸã¯ä¸‹çŸ¢å°ã‚­ãƒ¼ â”€â”€
        case "s":
        case "ArrowDown":
          e.preventDefault();
          onBackward();
          break;

        // â”€â”€ å·¦æ—‹å›: A ã‚­ãƒ¼ã¾ãŸã¯å·¦çŸ¢å°ã‚­ãƒ¼ â”€â”€
        case "a":
        case "ArrowLeft":
          e.preventDefault();
          onLeft();
          break;

        // â”€â”€ å³æ—‹å›: D ã‚­ãƒ¼ã¾ãŸã¯å³çŸ¢å°ã‚­ãƒ¼ â”€â”€
        case "d":
        case "ArrowRight":
          e.preventDefault();
          onRight();
          break;

        // â”€â”€ åœæ­¢: ã‚¹ãƒšãƒ¼ã‚¹ãƒãƒ¼ â”€â”€
        case " ":
          e.preventDefault();
          onStop();
          break;

        // â”€â”€ ç·Šæ€¥åœæ­¢: Escape ã‚­ãƒ¼ â”€â”€
        case "Escape":
          e.preventDefault();
          onEStop();
          break;
      }
      // â€» ã©ã®caseã«ã‚‚ä¸€è‡´ã—ãªã„å ´åˆã¯ä½•ã‚‚èµ·ãã¾ã›ã‚“ï¼ˆdefaultç¯€ã¯çœç•¥å¯èƒ½ï¼‰
    },
    // ä¾å­˜é…åˆ—: ã“ã‚Œã‚‰ã®å€¤ã®ã„ãšã‚Œã‹ãŒå¤‰ã‚ã‚‹ã¨ã€handleKeyDowné–¢æ•°ãŒå†ä½œæˆã•ã‚Œã‚‹
    // - enabled: ãƒ•ãƒƒã‚¯ã®æœ‰åŠ¹/ç„¡åŠ¹ãŒå¤‰ã‚ã£ãŸã¨ã
    // - onForwardç­‰: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒå¤‰ã‚ã£ãŸã¨ã
    [enabled, onForward, onBackward, onLeft, onRight, onStop, onEStop]
  );

  // ===================================================================
  // ğŸ”¼ handleKeyUp - ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸã¨ãã®å‡¦ç†
  // ===================================================================
  // ğŸ’¡ keydown vs keyup ã®é•ã„ï¼ˆé‡è¦ï¼ï¼‰
  // - keydownï¼ˆã‚­ãƒ¼ãƒ€ã‚¦ãƒ³ï¼‰: ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸç¬é–“ã«ç™ºç«ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
  //   â†’ æŠ¼ã—ç¶šã‘ã‚‹ã¨é€£ç¶šã§ç™ºç«ã™ã‚‹ï¼ˆãƒªãƒ”ãƒ¼ãƒˆï¼‰
  // - keyupï¼ˆã‚­ãƒ¼ã‚¢ãƒƒãƒ—ï¼‰: ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸç¬é–“ã«ç™ºç«ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
  //   â†’ 1å›ã ã‘ç™ºç«ã™ã‚‹
  //
  // ãªãœä¸¡æ–¹å¿…è¦ï¼Ÿ
  // - keydown ã§ç§»å‹•ã‚’é–‹å§‹ã—ã€keyup ã§åœæ­¢ã™ã‚‹
  // - ã“ã‚Œã«ã‚ˆã‚Šã€Œã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã„ã‚‹é–“ã ã‘ãƒ­ãƒœãƒƒãƒˆãŒå‹•ãã€ã¨ã„ã†
  //   ç›´æ„Ÿçš„ãªæ“ä½œãŒå®Ÿç¾ã§ãã¾ã™
  const handleKeyUp = useCallback(
    (e: KeyboardEvent) => {
      // ç„¡åŠ¹æ™‚ã¯ä½•ã‚‚ã—ãªã„
      if (!enabled) return;

      // .includes() ãƒ¡ã‚½ãƒƒãƒ‰: é…åˆ—ã«ç‰¹å®šã®è¦ç´ ãŒå«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      // - ç§»å‹•ç³»ã®ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸã¨ãã ã‘åœæ­¢å‡¦ç†ã‚’è¡Œã†
      // - ã‚¹ãƒšãƒ¼ã‚¹ãƒãƒ¼ã‚„Escapeã¯å¯¾è±¡å¤–ï¼ˆã“ã‚Œã‚‰ã¯å³åº§ã«åŠ¹æœãŒå‡ºã‚‹ãŸã‚ï¼‰
      if (["w", "s", "a", "d", "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key)) {
        // ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸã‚‰ã€ãƒ­ãƒœãƒƒãƒˆã‚’åœæ­¢ã•ã›ã‚‹
        onStop();
      }
    },
    // ä¾å­˜é…åˆ—: enabled ã¨ onStop ãŒå¤‰ã‚ã£ãŸã¨ãã ã‘é–¢æ•°ã‚’å†ä½œæˆ
    [enabled, onStop]
  );

  // ===================================================================
  // ğŸ“ useEffect - ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  // ===================================================================
  // useEffect ã®ä½¿ã„æ–¹ï¼š
  // useEffect(() => {
  //   // â‘  ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ï¼ˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼‰
  //   return () => {
  //     // â‘¡ ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰
  //   };
  // }, [ä¾å­˜é…åˆ—]);
  //
  // ğŸ’¡ addEventListenerï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ ï¼‰ã¨ã¯ï¼Ÿ
  // - window.addEventListener("keydown", handleKeyDown)
  //   â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å…¨ä½“ã§ã€Œkeydownã€ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã‚‰
  //     handleKeyDowné–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€ã¨ã„ã†ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²
  // - ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ = ã€Œç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã—ã¦ã€ç™ºç”Ÿã—ãŸã‚‰é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã€ä»•çµ„ã¿
  //
  // ğŸ’¡ removeEventListenerï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®å‰Šé™¤ï¼‰ã®é‡è¦æ€§
  // - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ï¼ˆreturn () => { ... }ï¼‰ã§å¿…ãšå‰Šé™¤ã™ã‚‹
  // - å‰Šé™¤ã—ãªã„ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ¶ˆãˆãŸå¾Œã‚‚ãƒªã‚¹ãƒŠãƒ¼ãŒæ®‹ã‚Šç¶šã‘ã€
  //   ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ï¼ˆä¸è¦ãªãƒ¡ãƒ¢ãƒªæ¶ˆè²»ï¼‰ã‚„äºˆæœŸã—ãªã„å‹•ä½œã®åŸå› ã«ãªã‚Šã¾ã™
  // - ç™»éŒ²ã¨å‰Šé™¤ã¯å¿…ãšãƒšã‚¢ã§è¡Œã†ã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™
  useEffect(() => {
    // â‘  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²
    window.addEventListener("keydown", handleKeyDown);
    window.addEventListener("keyup", handleKeyUp);

    // â‘¡ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã¨ãã€
    //    ã¾ãŸã¯ä¾å­˜é…åˆ—ã®å€¤ãŒå¤‰ã‚ã‚‹ã¨ãã«ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
    return () => {
      window.removeEventListener("keydown", handleKeyDown);
      window.removeEventListener("keyup", handleKeyUp);
    };
  }, [handleKeyDown, handleKeyUp]);
  // ä¾å­˜é…åˆ—: handleKeyDown ã¾ãŸã¯ handleKeyUp ãŒå¤‰ã‚ã£ãŸã‚‰ã€
  // å¤ã„ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã¦æ–°ã—ã„ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ç›´ã™
}
