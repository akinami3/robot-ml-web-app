# =============================================================================
# フロントエンド用 Dockerfile（開発環境向け）
# =============================================================================
#
# 【本番用との違い】
# - マルチステージビルドを使わない（シンプルな1段階構成）
# - Nginxではなく、ViteのDev Serverを直接使用
# - ホットリロード（HMR）対応: コードを変更すると自動的にブラウザに反映
# - ビルドステップなし: ソースコードをそのまま実行
#
# 【開発環境でDockerを使う理由】
# - チーム全員が同じ環境で開発できる（「自分のPCでは動くのに…」を防ぐ）
# - Node.jsのバージョンを統一できる
# - docker-compose で複数サービス（フロント、バック、DB）を一括管理
# =============================================================================

# 【FROM node:20-alpine】Node.js v20 の Alpine Linux版をベースイメージとして使用
# 開発環境なので AS build のようなステージ名は不要（1段階のみ）
FROM node:20-alpine

# 【WORKDIR /app】コンテナ内の作業ディレクトリを /app に設定
# 以降のすべてのコマンドはこのディレクトリ内で実行されます
WORKDIR /app

# 【依存関係のインストール】
# まず package.json と package-lock.json だけをコピーして npm ci を実行
# 【Dockerのレイヤーキャッシュ】
#   Dockerは各命令（FROM, COPY, RUNなど）の結果を「レイヤー」として保存します
#   前のレイヤーに変更がなければ、キャッシュされた結果を再利用します
#   → package.jsonが変わらなければ、npm ci をスキップ（時間を大幅短縮！）
COPY package.json package-lock.json* ./

# 【npm ci】package-lock.json に書かれた正確なバージョンで依存関係をインストール
# 開発の依存関係（devDependencies）も含めてインストールされます
RUN npm ci

# 【ソースコード全体をコピー】
# .dockerignore ファイルで node_modules/ などは除外されます
# （コンテナ内で npm ci で別途インストール済みのため）
COPY . .

# 【EXPOSE 3000】ViteのDev Serverがリッスンするポート番号
# Viteのデフォルトポートは5173ですが、vite.config.tsで3000に設定しています
EXPOSE 3000

# 【CMD】コンテナ起動時に実行されるコマンド
# JSON配列形式（exec form）で指定します
#   "npm" - npmコマンドを実行
#   "run" - package.jsonのscriptsセクションに定義されたスクリプトを実行
#   "dev" - 開発サーバーを起動するスクリプト名
#   "--"  - npm自体のオプションとスクリプトのオプションを区切る
#   "--host" "0.0.0.0" - すべてのネットワークインターフェースでリッスン
#     ※ Dockerコンテナ内では 0.0.0.0 にしないと外部（ホストPC）からアクセスできない
#     ※ "localhost" だとコンテナ内部からしかアクセスできません
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
